# ============================================
# DCM (Dart Code Metrics) ëª…ë ¹ì–´
# ============================================
# ì‚¬ìš©ë²•: make [ëª…ë ¹ì–´]
# ì˜ˆì‹œ: make unused-files
# ============================================

.PHONY: unused-files unused-code check-all dcm-install help

# DCM ì„¤ì¹˜ (ì²˜ìŒ í•œ ë²ˆë§Œ)
dcm-install:
	@echo "DCM ì„¤ì¹˜ ì¤‘..."
	dart pub global activate dart_code_metrics
	@echo "ì„¤ì¹˜ ì™„ë£Œ!"

# ì•ˆ ì“°ëŠ” íŒŒì¼ ì°¾ê¸°
unused-files:
	@echo "ğŸ” ì•ˆ ì“°ëŠ” íŒŒì¼ ê²€ì‚¬ ì¤‘..."
	@~/.pub-cache/bin/metrics check-unused-files lib --disable-sunset-warning

# ì•ˆ ì“°ëŠ” ì½”ë“œ ì°¾ê¸°
unused-code:
	@echo "ğŸ” ì•ˆ ì“°ëŠ” ì½”ë“œ ê²€ì‚¬ ì¤‘..."
	@~/.pub-cache/bin/metrics check-unused-code lib --disable-sunset-warning

# ë‘˜ ë‹¤ ì‹¤í–‰
check-all:
	@echo "=========================================="
	@echo "ğŸ“ ì•ˆ ì“°ëŠ” íŒŒì¼ ê²€ì‚¬"
	@echo "=========================================="
	@~/.pub-cache/bin/metrics check-unused-files lib --disable-sunset-warning
	@echo ""
	@echo "=========================================="
	@echo "ğŸ“ ì•ˆ ì“°ëŠ” ì½”ë“œ ê²€ì‚¬"
	@echo "=========================================="
	@~/.pub-cache/bin/metrics check-unused-code lib --disable-sunset-warning

# ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥
save-report:
	@echo "ë¦¬í¬íŠ¸ ì €ì¥ ì¤‘..."
	@~/.pub-cache/bin/metrics check-unused-files lib --disable-sunset-warning > docs/unused_files_latest.txt 2>&1
	@~/.pub-cache/bin/metrics check-unused-code lib --disable-sunset-warning > docs/unused_code_latest.txt 2>&1
	@echo "ì €ì¥ ì™„ë£Œ! docs/ í´ë” í™•ì¸í•˜ì„¸ìš”."

# ë„ì›€ë§
help:
	@echo "============================================"
	@echo "  DCM ëª…ë ¹ì–´ ë„ì›€ë§"
	@echo "============================================"
	@echo ""
	@echo "  make dcm-install   : DCM ì„¤ì¹˜ (ì²˜ìŒ í•œ ë²ˆë§Œ)"
	@echo "  make unused-files  : ì•ˆ ì“°ëŠ” íŒŒì¼ ì°¾ê¸°"
	@echo "  make unused-code   : ì•ˆ ì“°ëŠ” ì½”ë“œ ì°¾ê¸°"
	@echo "  make check-all     : ë‘˜ ë‹¤ ì‹¤í–‰"
	@echo "  make save-report   : ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥"
	@echo "  make help          : ì´ ë„ì›€ë§ ë³´ê¸°"
	@echo ""
	@echo "============================================"

# ============================================
# ê¸°íƒ€ ìœ ìš©í•œ ëª…ë ¹ì–´
# ============================================

# Flutter ê´€ë ¨
run:
	flutter run

build:
	flutter build apk --release

clean:
	flutter clean && flutter pub get

codegen:
	dart run build_runner build --delete-conflicting-outputs
